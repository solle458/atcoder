# AHC048 Solution: Mixing on the Palette

## 概要

AtCoder Heuristic Contest 048「Mixing on the Palette」問題の解答プログラムです。N×Nのパレット上で、K種類のチューブ絵の具を使用してH個の目標色を順番に作成し、画伯に渡すゲームを自動化します。

## 問題の詳細

- **パレット**: N×N のグリッド、仕切りで複数のウェルに分割可能
- **絵の具**: K種類のチューブ絵の具（CMY色空間）
- **目標**: H個の目標色を順番通りに作成
- **制約**: 最大Tターン、絵の具使用コストD
- **評価**: `1 + D×(V-H) + round(10^4×E)` を最小化

## 実装したアルゴリズム

### 1. 基本データ構造

#### Color クラス
- CMY色空間での色表現
- 色間距離計算（ユークリッド距離）
- 色混合演算

#### Well クラス
- ウェルの状態管理（容量、絵の具量、色）
- 絵の具の追加・取り出し・廃棄操作
- 物理法則に従った色混合計算

#### Palette クラス
- パレット全体の管理
- 仕切り操作によるウェル構築
- 連結成分解析によるウェル分割・統合

#### GameState クラス
- ゲーム状態の統合管理
- 操作の実行と検証
- スコア計算

### 2. 戦略アルゴリズム

#### GreedyStrategy（貪欲法）
- 目標色に最も近い色を持つウェルを探索
- 2色混合による色近似
- 積極的な渡し判定（緊急時対応）

#### BeamSearchStrategy（ビームサーチ）
- 複数手先読みによる最適化
- ビーム幅8、探索深度4
- 総合的な状態評価関数

#### SimulatedAnnealingStrategy（焼きなまし法）
- 局所最適解回避
- 温度パラメータによる受容確率制御
- ランダム性を活用した探索

#### HybridWellSelection（ハイブリッドウェル選択）【新機能】
- **最適選択**: 詳細評価による効率重視
- **ランダム選択**: 多様性重視の確率的選択
- **適応的制御**: 性能に基づく戦略自動調整
- **ルーレット選択**: スコア重み付きランダム選択

### 3. 自動戦略選択

問題サイズに基づく動的戦略選択：
- 小問題（N×H ≤ 50）: ビームサーチ
- 大問題（N×H > 50）: 貪欲法
- 時間制限接近時: 貪欲法への自動切替

## 技術的特徴

### 1. 色混合最適化
- 2色混合による目標色近似
- 混合効果の予測計算
- 最適チューブ選択アルゴリズム

### 1.1. ウェル活用最適化【新機能】
- **多様化したウェルの効率的活用**
- **探索と活用のバランス制御**
- **局所最適解の回避**
- **実行時統計に基づく適応的調整**

### 2. パフォーマンス最適化
- 実行時間監視（3秒制限対応）
- メモリ効率的なデータ構造
- C++17最適化フラグ活用

### 3. エラーハンドリング
- 操作の事前検証
- 例外安全な実装
- 堅牢なフォールバック機能

## ビルド・実行方法

### コンパイル
```bash
g++ -std=c++17 -O2 -o main main.cpp
```

### 実行
```bash
./main < input.txt
```

### 入力形式
```
N K H T D
C1 M1 Y1    # チューブ色1
...
CK MK YK    # チューブ色K
C1 M1 Y1    # 目標色1
...
CH MH YH    # 目標色H
```

### 出力形式
```
# 初期仕切り状態
v0,0 v0,1 ... v0,N-2    # 縦仕切り
...
h0,0 h0,1 ... h0,N-1    # 横仕切り
...

# 操作列
1 i j k     # 操作1: チューブkから(i,j)に追加
2 i j       # 操作2: (i,j)から画伯に渡す  
3 i j       # 操作3: (i,j)の絵の具を廃棄
4 i1 j1 i2 j2  # 操作4: 仕切り操作
```

## 新機能のパラメータ調整

### ウェル選択戦略パラメータ
```cpp
// 基本設定
double randomWellProbability = 0.3;    // ランダム選択確率（0.0-1.0）
double explorationBonus = 2.0;         // 探索ボーナス重み
bool adaptiveWellSelection = true;     // 適応的選択の有効化
double adaptationRate = 0.1;           // 適応率（0.0-1.0）

// 使用例
// 探索重視: randomWellProbability = 0.7
// 効率重視: randomWellProbability = 0.1  
// 自動調整: adaptiveWellSelection = true
```

### 動作モード
- **OPTIMAL_ONLY**: 従来の最適化選択のみ
- **RANDOM_ONLY**: ランダム選択のみ（探索特化）
- **FIXED_HYBRID**: 固定比率でのハイブリッド選択
- **ADAPTIVE_HYBRID**: 性能に基づく自動調整（推奨）

## パフォーマンス

### テスト結果例

#### 小問題（2×2, 3色, 1目標）
- 実行時間: 1ms
- 完成率: 100%
- スコア: 4045

#### 中問題（4×4, 4色, 3目標）
- 実行時間: 6ms
- 完成率: 67% (2/3)
- スコア: 1035

## 制限事項・改善点

### 現在の制限
1. 仕切り操作（操作4）の最適化が不十分
2. 大規模問題での探索時間制限
3. 複雑な色混合パターンの網羅性

### 今後の改善案
1. **遺伝的アルゴリズム**による初期配置最適化
2. **強化学習**による長期戦略学習
3. **並列化**による探索高速化
4. **機械学習**による色混合予測

## ライセンス

このプログラムは競技プログラミング用途で作成されました。
教育・研究目的での使用を歓迎します。

## 開発者

AtCoder AHC048 参加者

---

*最終更新: 2025年*
